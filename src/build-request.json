{
  "kind": "build_request",
  "title": "Add editable payment checkout and Razorpay options in service marketplace",
  "projectName": "Quick Bee Agency",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Add UI controls in the service marketplace (ServicesPage.tsx) to allow admins to configure Razorpay payment options for each service, similar to the existing payment link editing functionality",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Add easy editing for payment checkouts and Razorpay options in the service marketplace"
        ]
      },
      "acceptanceCriteria": [
        "Admin users can access Razorpay configuration controls from the service marketplace",
        "The UI provides clear options to enable/disable Razorpay for individual services",
        "Changes to Razorpay settings are persisted to the backend"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Extend the Service type in backend/main.mo to include Razorpay-specific fields (razorpayEnabled: Bool, razorpayKeyId: ?Text, razorpayOrderId: ?Text) to support storing Razorpay payment configuration per service",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Enable editable checkout and Razorpay payment options in the service marketplace"
        ]
      },
      "acceptanceCriteria": [
        "Service type includes new Razorpay fields",
        "Existing services can be migrated with default Razorpay values (razorpayEnabled = false)",
        "New services can be created with Razorpay configuration"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Create a ServiceRazorpayDialog component similar to ServicePaymentInfoDialog that allows editing Razorpay settings (enable/disable toggle, Razorpay key ID input) for a specific service",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Let users edit checkout and Razorpay options on the service marketplace"
        ]
      },
      "acceptanceCriteria": [
        "Dialog displays current Razorpay configuration for the selected service",
        "Users can toggle Razorpay enabled/disabled state",
        "Users can input and save Razorpay key ID",
        "Dialog integrates with existing service update mutation"
      ]
    },
    {
      "id": "REQ-4",
      "text": "Add backend methods (updateServiceRazorpay, getServiceRazorpayConfig) to manage Razorpay configuration for services with proper access control (admin-only)",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Enable editable checkout and Razorpay payment options in the service marketplace"
        ]
      },
      "acceptanceCriteria": [
        "Only admin users can update Razorpay settings for services",
        "Methods validate Razorpay key ID format if provided",
        "Methods return success/error responses appropriately"
      ]
    },
    {
      "id": "REQ-5",
      "text": "Display Razorpay payment option status in the service detail view (ServiceDetailPage.tsx) showing whether Razorpay is enabled and providing a button to edit Razorpay settings for admins",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Add easy editing for payment checkouts and Razorpay options in the service marketplace"
        ]
      },
      "acceptanceCriteria": [
        "Service detail page shows Razorpay enabled/disabled badge",
        "Admin users see an 'Edit Razorpay' button next to payment info controls",
        "Button opens ServiceRazorpayDialog with current service context"
      ]
    },
    {
      "id": "REQ-6",
      "text": "Extend the checkout flow in CheckoutPage.tsx to support Razorpay as an alternative payment method when services in cart have Razorpay enabled, displaying both Stripe and Razorpay options to users",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Simplify adding Razorpay and editable payment checkouts to the service marketplace"
        ]
      },
      "acceptanceCriteria": [
        "Checkout page detects if any cart items have Razorpay enabled",
        "Users see payment method selection (Stripe/Razorpay) when Razorpay is available",
        "Razorpay payment flow initiates correctly with proper order details",
        "Fallback to Stripe-only when no services have Razorpay enabled"
      ]
    }
  ],
  "constraints": [
    "Maintain single-actor architecture in backend/main.mo",
    "Do not modify immutable frontend paths: useInternetIdentity hooks, useActor.ts, main.tsx, and frontend/src/components/ui",
    "Preserve existing payment link and QR code functionality",
    "Ensure Razorpay integration respects existing access control patterns"
  ],
  "nonGoals": [
    "Replacing existing Stripe payment integration",
    "Implementing Razorpay webhook handlers or payment verification",
    "Adding Razorpay configuration to leads or projects",
    "Creating separate Razorpay checkout pages outside the existing checkout flow"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}